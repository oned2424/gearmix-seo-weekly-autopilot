# サービスアカウント作成 完全ガイド

このガイドでは、Google Cloud Platformでサービスアカウントを作成し、JSONキーをダウンロードする手順を**画面ごとに**詳しく説明します。

---

## 📌 サービスアカウントとは?

**サービスアカウント**は、人間ではなく「プログラム」がGoogleのサービス(Search ConsoleやGA4)にアクセスするための特別なアカウントです。

通常のGoogleアカウント(例: yourname@gmail.com)とは違い、プログラム専用のメールアドレス(例: bot@project.iam.gserviceaccount.com)が発行されます。

---

## 🚀 STEP 1: Google Cloud Consoleにアクセス

### 1-1. ブラウザで開く

以下のURLをブラウザで開いてください:

```
https://console.cloud.google.com/
```

### 1-2. Googleアカウントでログイン

- gearmix.co.jpのSearch ConsoleとGA4にアクセスできるGoogleアカウントでログインしてください
- 初めてGoogle Cloud Consoleを使う場合、利用規約への同意画面が表示されることがあります → 「同意して続行」をクリック

---

## 🏗️ STEP 2: プロジェクトを作成

### 2-1. プロジェクト選択画面を開く

画面の**一番上**に「プロジェクトを選択」というボタンがあります(Google Cloudのロゴの右側)。

このボタンをクリックしてください。

### 2-2. 新しいプロジェクトを作成

ポップアップが表示されます。

1. 右上の「**新しいプロジェクト**」ボタンをクリック
2. 新しい画面が開きます

### 2-3. プロジェクト情報を入力

以下の情報を入力してください:

| 項目 | 入力内容 |
|------|----------|
| **プロジェクト名** | ` gearmix-seo-weekly-autopilot ` |
| **組織** | そのまま(変更不要) |
| **場所** | そのまま(変更不要) |

入力したら、画面下部の「**作成**」ボタンをクリックしてください。

### 2-4. プロジェクトが作成されるまで待つ

数秒〜数十秒待つと、プロジェクトが作成されます。

画面右上に「プロジェクトを作成しています...」という通知が表示されます。

作成が完了すると、自動的に新しいプロジェクトに切り替わります。

---

## 🔌 STEP 3: APIを有効化する

### 3-1. APIライブラリを開く

1. 画面左上の「**≡**」(ハンバーガーメニュー)をクリック
2. メニューが開くので、「**APIとサービス**」にマウスを合わせる
3. サブメニューが表示されるので、「**ライブラリ**」をクリック

### 3-2. Search Console APIを有効化

1. 「APIライブラリへようこそ」という画面が表示されます
2. 上部の検索ボックスに「**search console**」と入力
3. 検索結果に「**Google Search Console API**」が表示されるのでクリック
4. 「**有効にする**」ボタンをクリック
5. 数秒待つと「APIが有効になりました」と表示されます

### 3-3. Google Analytics Data APIを有効化

1. 画面左上の「**← ライブラリ**」をクリックして、APIライブラリ画面に戻る
2. 上部の検索ボックスに「**analytics data**」と入力
3. 検索結果に「**Google Analytics Data API**」が表示されるのでクリック
4. 「**有効にする**」ボタンをクリック
5. 数秒待つと「APIが有効になりました」と表示されます

---

## 🎫 STEP 4: サービスアカウントを作成

### 4-1. 認証情報画面を開く

1. 画面左上の「**≡**」(ハンバーガーメニュー)をクリック
2. 「**APIとサービス**」にマウスを合わせる
3. 「**認証情報**」をクリック

### 4-2. サービスアカウント作成を開始

1. 画面上部の「**+ 認証情報を作成**」ボタンをクリック
2. ドロップダウンメニューが表示されるので、「**サービスアカウント**」を選択

### 4-3. サービスアカウントの詳細を入力

「サービスアカウントの詳細」という画面が表示されます。

以下の情報を入力してください:

| 項目 | 入力内容 |
|------|----------|
| **サービスアカウント名** | `gmx-seo-reporter-bot` |
| **サービスアカウントID** | 自動入力されます(そのままでOK) |
| **サービスアカウントの説明** | `週次SEOレポート自動生成用` |

入力したら、「**作成して続行**」ボタンをクリック。

### 4-4. ロール選択(スキップ)

「このサービスアカウントにプロジェクトへのアクセスを許可する」という画面が表示されます。

**何も選択せず**、「**続行**」ボタンをクリックしてください。

> **💡 なぜスキップ?**: このサービスアカウントはGoogle Cloud Projectではなく、Search ConsoleとGA4にアクセスします。そのため、ここでロールを設定する必要はありません。

### 4-5. ユーザーアクセス(スキップ)

「ユーザーにこのサービスアカウントへのアクセスを許可」という画面が表示されます。

**何も入力せず**、「**完了**」ボタンをクリックしてください。

### 4-6. サービスアカウントが作成されました!

「認証情報」画面に戻ります。

画面下部の「**サービスアカウント**」セクションに、作成したサービスアカウントが表示されているはずです:

```
gmx-seo-reporter-bot@gearmix-seo-reporter.iam.gserviceaccount.com
```

---

## 🔑 STEP 5: JSONキーをダウンロード

### 5-1. サービスアカウントの詳細画面を開く

「認証情報」画面の「サービスアカウント」セクションで、先ほど作成したサービスアカウント(gmx-seo-reporter-bot@...)の**メールアドレス部分**をクリックしてください。

### 5-2. キータブを開く

サービスアカウントの詳細画面が開きます。

上部のタブから「**キー**」タブをクリックしてください。

### 5-3. 新しいキーを作成

1. 「**鍵を追加**」ボタンをクリック
2. ドロップダウンメニューが表示されるので、「**新しい鍵を作成**」を選択

### 5-4. キーのタイプを選択

ポップアップが表示されます。

1. 「**JSON**」を選択(デフォルトで選択されているはずです)
2. 「**作成**」ボタンをクリック

### 5-5. JSONファイルが自動ダウンロードされます

ブラウザのダウンロードフォルダに、以下のような名前のファイルがダウンロードされます:

```
gearmix-seo-reporter-xxxxxxxxxxxxxx.json
```

> **⚠️ 超重要**: このJSONファイルは**秘密鍵**です!
> - 絶対に他人に見せないでください
> - GitHubにアップロードしないでください
> - 安全な場所に保管してください

---

## 📧 STEP 6: サービスアカウントのメールアドレスをコピー

### 6-1. JSONファイルを開く

ダウンロードしたJSONファイルを**テキストエディタ**で開いてください。

- Mac: テキストエディット、VSCode、Sublime Textなど
- Windows: メモ帳、VSCode、Notepad++など

### 6-2. client_emailをコピー

JSONファイルの中に、以下のような行があります:

```json
{
  "type": "service_account",
  "project_id": "gearmix-seo-reporter",
  "private_key_id": "...",
  "private_key": "...",
  "client_email": "gmx-seo-reporter-bot@gearmix-seo-reporter.iam.gserviceaccount.com",
  ...
}
```

この中の `"client_email"` の値(メールアドレス部分)をコピーしてください。

例:
```
gmx-seo-reporter-bot@gearmix-seo-reporter.iam.gserviceaccount.com
```

> **📝 メモ**: このメールアドレスは、次のステップでSearch ConsoleとGA4に追加します。

---

## ✅ 完了!

お疲れ様でした!サービスアカウントの作成とJSONキーのダウンロードが完了しました。

### 確認事項

以下が揃っていることを確認してください:

- ✅ Google Cloud Projectを作成した(`gearmix-seo-weekly-autopilot`)
- ✅ Search Console APIを有効化した
- ✅ Google Analytics Data APIを有効化した
- ✅ サービスアカウントを作成した(`gmx-seo-reporter-bot`)
- ✅ JSONキーファイルをダウンロードした
- ✅ サービスアカウントのメールアドレスをコピーした

---

## 🎯 次のステップ

次は、このサービスアカウントに**Search ConsoleとGA4へのアクセス権限**を付与します。

詳細は `docs/SETUP_GUIDE.md` の「STEP 4: Search Consoleへのアクセス権限付与」を参照してください。

---

## ❓ よくある質問

### Q1: サービスアカウントって何個作れるの?

A: 1つのプロジェクトで最大100個まで作成できますが、今回は1つだけで十分です。

### Q2: JSONキーを紛失したらどうなる?

A: 再ダウンロードはできませんが、新しいキーを作成できます。古いキーは削除して、新しいキーを使用してください。

### Q3: サービスアカウントを削除したい場合は?

A: 「認証情報」画面のサービスアカウント一覧から、削除したいアカウントを選択して削除できます。

### Q4: エラーが出た場合は?

A: エラーメッセージをコピーして教えてください。一緒に解決しましょう!
